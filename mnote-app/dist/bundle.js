(()=>{var rn=Object.create;var Ye=Object.defineProperty;var ln=Object.getOwnPropertyDescriptor;var an=Object.getOwnPropertyNames;var cn=Object.getPrototypeOf,un=Object.prototype.hasOwnProperty;var dn=t=>Ye(t,"__esModule",{value:!0});var mn=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var fn=(t,e,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of an(e))!un.call(t,i)&&i!=="default"&&Ye(t,i,{get:()=>e[i],enumerable:!(n=ln(e,i))||n.enumerable});return t},hn=t=>fn(dn(Ye(t!=null?rn(cn(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var w=(t,e,n)=>new Promise((i,r)=>{var o=d=>{try{g(n.next(d))}catch(y){r(y)}},m=d=>{try{g(n.throw(d))}catch(y){r(y)}},g=d=>d.done?i(d.value):Promise.resolve(d.value).then(o,m);g((n=n.apply(t,e)).next())});var en=mn((lo,Ge)=>{(function(t,e,n){if(!t)return;for(var i={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},r={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},o={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},m={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},g,d=1;d<20;++d)i[111+d]="f"+d;for(d=0;d<=9;++d)i[d+96]=d.toString();function y(l,f,k){if(l.addEventListener){l.addEventListener(f,k,!1);return}l.attachEvent("on"+f,k)}function s(l){if(l.type=="keypress"){var f=String.fromCharCode(l.which);return l.shiftKey||(f=f.toLowerCase()),f}return i[l.which]?i[l.which]:r[l.which]?r[l.which]:String.fromCharCode(l.which).toLowerCase()}function C(l,f){return l.sort().join(",")===f.sort().join(",")}function _(l){var f=[];return l.shiftKey&&f.push("shift"),l.altKey&&f.push("alt"),l.ctrlKey&&f.push("ctrl"),l.metaKey&&f.push("meta"),f}function h(l){if(l.preventDefault){l.preventDefault();return}l.returnValue=!1}function E(l){if(l.stopPropagation){l.stopPropagation();return}l.cancelBubble=!0}function W(l){return l=="shift"||l=="ctrl"||l=="alt"||l=="meta"}function T(){if(!g){g={};for(var l in i)l>95&&l<112||i.hasOwnProperty(l)&&(g[i[l]]=l)}return g}function A(l,f,k){return k||(k=T()[l]?"keydown":"keypress"),k=="keypress"&&f.length&&(k="keydown"),k}function K(l){return l==="+"?["+"]:(l=l.replace(/\+{2}/g,"+plus"),l.split("+"))}function $(l,f){var k,N,q,te=[];for(k=K(l),q=0;q<k.length;++q)N=k[q],m[N]&&(N=m[N]),f&&f!="keypress"&&o[N]&&(N=o[N],te.push("shift")),W(N)&&te.push(N);return f=A(N,te,f),{key:N,modifiers:te,action:f}}function B(l,f){return l===null||l===e?!1:l===f?!0:B(l.parentNode,f)}function D(l){var f=this;if(l=l||e,!(f instanceof D))return new D(l);f.target=l,f._callbacks={},f._directMap={};var k={},N,q=!1,te=!1,ne=!1;function fe(v){v=v||{};var L=!1,F;for(F in k){if(v[F]){L=!0;continue}k[F]=0}L||(ne=!1)}function se(v,L,F,S,I,X){var P,c,a=[],u=F.type;if(!f._callbacks[v])return[];for(u=="keyup"&&W(v)&&(L=[v]),P=0;P<f._callbacks[v].length;++P)if(c=f._callbacks[v][P],!(!S&&c.seq&&k[c.seq]!=c.level)&&u==c.action&&(u=="keypress"&&!F.metaKey&&!F.ctrlKey||C(L,c.modifiers))){var p=!S&&c.combo==I,H=S&&c.seq==S&&c.level==X;(p||H)&&f._callbacks[v].splice(P,1),a.push(c)}return a}function ae(v,L,F,S){f.stopCallback(L,L.target||L.srcElement,F,S)||v(L,F)===!1&&(h(L),E(L))}f._handleKey=function(v,L,F){var S=se(v,L,F),I,X={},P=0,c=!1;for(I=0;I<S.length;++I)S[I].seq&&(P=Math.max(P,S[I].level));for(I=0;I<S.length;++I){if(S[I].seq){if(S[I].level!=P)continue;c=!0,X[S[I].seq]=1,ae(S[I].callback,F,S[I].combo,S[I].seq);continue}c||ae(S[I].callback,F,S[I].combo)}var a=F.type=="keypress"&&te;F.type==ne&&!W(v)&&!a&&fe(X),te=c&&F.type=="keydown"};function ce(v){typeof v.which!="number"&&(v.which=v.keyCode);var L=s(v);if(!!L){if(v.type=="keyup"&&q===L){q=!1;return}f.handleKey(L,_(v),v)}}function Xe(){clearTimeout(N),N=setTimeout(fe,1e3)}function _e(v,L,F,S){k[v]=0;function I(u){return function(){ne=u,++k[v],Xe()}}function X(u){ae(F,u,v),S!=="keyup"&&(q=s(u)),setTimeout(fe,10)}for(var P=0;P<L.length;++P){var c=P+1===L.length,a=c?X:I(S||$(L[P+1]).action);ve(L[P],a,S,v,P)}}function ve(v,L,F,S,I){f._directMap[v+":"+F]=L,v=v.replace(/\s+/g," ");var X=v.split(" "),P;if(X.length>1){_e(v,X,L,F);return}P=$(v,F),f._callbacks[P.key]=f._callbacks[P.key]||[],se(P.key,P.modifiers,{type:P.action},S,v,I),f._callbacks[P.key][S?"unshift":"push"]({callback:L,modifiers:P.modifiers,action:P.action,seq:S,level:I,combo:v})}f._bindMultiple=function(v,L,F){for(var S=0;S<v.length;++S)ve(v[S],L,F)},y(l,"keypress",ce),y(l,"keydown",ce),y(l,"keyup",ce)}D.prototype.bind=function(l,f,k){var N=this;return l=l instanceof Array?l:[l],N._bindMultiple.call(N,l,f,k),N},D.prototype.unbind=function(l,f){var k=this;return k.bind.call(k,l,function(){},f)},D.prototype.trigger=function(l,f){var k=this;return k._directMap[l+":"+f]&&k._directMap[l+":"+f]({},l),k},D.prototype.reset=function(){var l=this;return l._callbacks={},l._directMap={},l},D.prototype.stopCallback=function(l,f){var k=this;if((" "+f.className+" ").indexOf(" mousetrap ")>-1||B(f,k.target))return!1;if("composedPath"in l&&typeof l.composedPath=="function"){var N=l.composedPath()[0];N!==l.target&&(f=N)}return f.tagName=="INPUT"||f.tagName=="SELECT"||f.tagName=="TEXTAREA"||f.isContentEditable},D.prototype.handleKey=function(){var l=this;return l._handleKey.apply(l,arguments)},D.addKeycodes=function(l){for(var f in l)l.hasOwnProperty(f)&&(i[f]=l[f]);g=null},D.init=function(){var l=D(e);for(var f in l)f.charAt(0)!=="_"&&(D[f]=function(k){return function(){return l[k].apply(l,arguments)}}(f))},D.init(),t.Mousetrap=D,typeof Ge!="undefined"&&Ge.exports&&(Ge.exports=D),typeof define=="function"&&define.amd&&define(function(){return D})})(typeof window!="undefined"?window:null,typeof window!="undefined"?document:null)});var be=class{constructor(e){this.element=e}on(e,n,i){return this.element.addEventListener(e,n,i),this}off(e,n){return this.element.removeEventListener(e,n),this}attr(e,n){return this.element.setAttribute(e,n),this}id(e){return this.element.id=e,this}class(e){return this.element.classList.add(e),this}hook(e){return e(this),this}inner(e){return this.element.innerHTML=e,this}style(e,n){return this.element.style[e]=n,this}children(...e){return e.forEach(n=>{this.element.appendChild(n)}),this}parent(e){return e.appendChild(this.element),this}};function M(t){return new be(document.createElement(t))}var G=typeof window!="undefined"?window:null,Ze=G===null,he=Ze?void 0:G.document,Y="addEventListener",Z="removeEventListener",Je="getBoundingClientRect",pe="_a",J="_b",ie="_c",xe="horizontal",Q=()=>!1,pn=Ze?"calc":`${["","-webkit-","-moz-","-o-"].filter(t=>{let e=he.createElement("div");return e.style.cssText=`width:${t}calc(9px)`,!!e.style.length}).shift()}calc`,ut=t=>typeof t=="string"||t instanceof String,dt=t=>{if(ut(t)){let e=he.querySelector(t);if(!e)throw new Error(`Selector ${t} did not match a DOM element`);return e}return t},R=(t,e,n)=>{let i=t[e];return i!==void 0?i:n},Ee=(t,e,n,i)=>{if(e){if(i==="end")return 0;if(i==="center")return t/2}else if(n){if(i==="start")return 0;if(i==="center")return t/2}return t},gn=(t,e)=>{let n=he.createElement("div");return n.className=`gutter gutter-${e}`,n},_n=(t,e,n)=>{let i={};return ut(e)?i[t]=e:i[t]=`${pn}(${e}% - ${n}px)`,i},vn=(t,e)=>({[t]:`${e}px`}),yn=(t,e={})=>{if(Ze)return{};let n=t,i,r,o,m,g,d;Array.from&&(n=Array.from(n));let s=dt(n[0]).parentNode,C=getComputedStyle?getComputedStyle(s):null,_=C?C.flexDirection:null,h=R(e,"sizes")||n.map(()=>100/n.length),E=R(e,"minSize",100),W=Array.isArray(E)?E:n.map(()=>E),T=R(e,"maxSize",1/0),A=Array.isArray(T)?T:n.map(()=>T),K=R(e,"expandToMin",!1),$=R(e,"gutterSize",10),B=R(e,"gutterAlign","center"),D=R(e,"snapOffset",30),l=R(e,"dragInterval",1),f=R(e,"direction",xe),k=R(e,"cursor",f===xe?"col-resize":"row-resize"),N=R(e,"gutter",gn),q=R(e,"elementStyle",_n),te=R(e,"gutterStyle",vn);f===xe?(i="width",r="clientX",o="left",m="right",g="clientWidth"):f==="vertical"&&(i="height",r="clientY",o="top",m="bottom",g="clientHeight");function ne(c,a,u,p){let H=q(i,a,u,p);Object.keys(H).forEach(U=>{c.style[U]=H[U]})}function fe(c,a,u){let p=te(i,a,u);Object.keys(p).forEach(H=>{c.style[H]=p[H]})}function se(){return d.map(c=>c.size)}function ae(c){return"touches"in c?c.touches[0][r]:c[r]}function ce(c){let a=d[this.a],u=d[this.b],p=a.size+u.size;a.size=c/this.size*p,u.size=p-c/this.size*p,ne(a.element,a.size,this[J],a.i),ne(u.element,u.size,this[ie],u.i)}function Xe(c){let a,u=d[this.a],p=d[this.b];!this.dragging||(a=ae(c)-this.start+(this[J]-this.dragOffset),l>1&&(a=Math.round(a/l)*l),a<=u.minSize+D+this[J]?a=u.minSize+this[J]:a>=this.size-(p.minSize+D+this[ie])&&(a=this.size-(p.minSize+this[ie])),a>=u.maxSize-D+this[J]?a=u.maxSize+this[J]:a<=this.size-(p.maxSize-D+this[ie])&&(a=this.size-(p.maxSize+this[ie])),ce.call(this,a),R(e,"onDrag",Q)(se()))}function _e(){let c=d[this.a].element,a=d[this.b].element,u=c[Je](),p=a[Je]();this.size=u[i]+p[i]+this[J]+this[ie],this.start=u[o],this.end=u[m]}function ve(c){if(!getComputedStyle)return null;let a=getComputedStyle(c);if(!a)return null;let u=c[g];return u===0?null:(f===xe?u-=parseFloat(a.paddingLeft)+parseFloat(a.paddingRight):u-=parseFloat(a.paddingTop)+parseFloat(a.paddingBottom),u)}function v(c){let a=ve(s);if(a===null||W.reduce((U,V)=>U+V,0)>a)return c;let u=0,p=[],H=c.map((U,V)=>{let re=a*U/100,ye=Ee($,V===0,V===c.length-1,B),Me=W[V]+ye;return re<Me?(u+=Me-re,p.push(0),Me):(p.push(re-Me),re)});return u===0?c:H.map((U,V)=>{let re=U;if(u>0&&p[V]-u>0){let ye=Math.min(u,p[V]-u);u-=ye,re=U-ye}return re/a*100})}function L(){let c=this,a=d[c.a].element,u=d[c.b].element;c.dragging&&R(e,"onDragEnd",Q)(se()),c.dragging=!1,G[Z]("mouseup",c.stop),G[Z]("touchend",c.stop),G[Z]("touchcancel",c.stop),G[Z]("mousemove",c.move),G[Z]("touchmove",c.move),c.stop=null,c.move=null,a[Z]("selectstart",Q),a[Z]("dragstart",Q),u[Z]("selectstart",Q),u[Z]("dragstart",Q),a.style.userSelect="",a.style.webkitUserSelect="",a.style.MozUserSelect="",a.style.pointerEvents="",u.style.userSelect="",u.style.webkitUserSelect="",u.style.MozUserSelect="",u.style.pointerEvents="",c.gutter.style.cursor="",c.parent.style.cursor="",he.body.style.cursor=""}function F(c){if("button"in c&&c.button!==0)return;let a=this,u=d[a.a].element,p=d[a.b].element;a.dragging||R(e,"onDragStart",Q)(se()),c.preventDefault(),a.dragging=!0,a.move=Xe.bind(a),a.stop=L.bind(a),G[Y]("mouseup",a.stop),G[Y]("touchend",a.stop),G[Y]("touchcancel",a.stop),G[Y]("mousemove",a.move),G[Y]("touchmove",a.move),u[Y]("selectstart",Q),u[Y]("dragstart",Q),p[Y]("selectstart",Q),p[Y]("dragstart",Q),u.style.userSelect="none",u.style.webkitUserSelect="none",u.style.MozUserSelect="none",u.style.pointerEvents="none",p.style.userSelect="none",p.style.webkitUserSelect="none",p.style.MozUserSelect="none",p.style.pointerEvents="none",a.gutter.style.cursor=k,a.parent.style.cursor=k,he.body.style.cursor=k,_e.call(a),a.dragOffset=ae(c)-a.end}h=v(h);let S=[];d=n.map((c,a)=>{let u={element:dt(c),size:h[a],minSize:W[a],maxSize:A[a],i:a},p;if(a>0&&(p={a:a-1,b:a,dragging:!1,direction:f,parent:s},p[J]=Ee($,a-1==0,!1,B),p[ie]=Ee($,!1,a===n.length-1,B),_==="row-reverse"||_==="column-reverse")){let H=p.a;p.a=p.b,p.b=H}if(a>0){let H=N(a,f,u.element);fe(H,$,a),p[pe]=F.bind(p),H[Y]("mousedown",p[pe]),H[Y]("touchstart",p[pe]),s.insertBefore(H,u.element),p.gutter=H}return ne(u.element,u.size,Ee($,a===0,a===n.length-1,B),a),a>0&&S.push(p),u});function I(c){let a=c.i===S.length,u=a?S[c.i-1]:S[c.i];_e.call(u);let p=a?u.size-c.minSize-u[ie]:c.minSize+u[J];ce.call(u,p)}d.forEach(c=>{let a=c.element[Je]()[i];a<c.minSize&&(K?I(c):c.minSize=a)});function X(c){let a=v(c);a.forEach((u,p)=>{if(p>0){let H=S[p-1],U=d[H.a],V=d[H.b];U.size=a[p-1],V.size=u,ne(U.element,U.size,H[J],U.i),ne(V.element,V.size,H[ie],V.i)}})}function P(c,a){S.forEach(u=>{if(a!==!0?u.parent.removeChild(u.gutter):(u.gutter[Z]("mousedown",u[pe]),u.gutter[Z]("touchstart",u[pe])),c!==!0){let p=q(i,u.a.size,u[J]);Object.keys(p).forEach(H=>{d[u.a].element.style[H]="",d[u.b].element.style[H]=""})}})}return{setSizes:X,getSizes:se,collapse(c){I(d[c])},destroy:P,parent:s,pairs:S}},mt=yn;var Se=class{constructor(e){this.menubar=(()=>M("div").class("layout-menubar").element)(),this.sidebar=(()=>(this.filetree=M("div").class("sidebar-filetree").element,this.sidebarMenu=M("div").class("sidebar-menu").element,M("div").class("layout-sidebar").children(this.filetree,this.sidebarMenu).element))(),this.contents=(()=>M("div").class("layout-contents").element)();let n=M("div").class("layout-container").children(this.menubar,this.contents).element;this.main=M("div").class("layout").children(this.sidebar,n).element,mt([this.sidebar,n],{gutterSize:5,sizes:[20,80]}),e.element.appendChild(this.main)}mountToSidebarMenu(e){this.sidebarMenu.innerHTML="",this.sidebarMenu.appendChild(e)}mountToFiletree(e){this.filetree.innerHTML="",this.filetree.appendChild(e)}mountToContents(e){this.contents.innerHTML="",this.contents.appendChild(e)}mountToMenubar(e){this.menubar.innerHTML="",this.menubar.appendChild(e)}};var we=class{constructor(e){this.extensions=[];this.app=e}add(e){return this.extensions.push(e),e.startup(),this}remove(e){let n=this.extensions.indexOf(e);if(n!==void 0)return delete this.extensions[n],e.cleanup(),this}};var j=class{constructor(){this.events={}}on(e,n){let i=this.events[e];i||(i=[],this.events[e]=i),i.push(n)}remove(e,n){let i=this.events[e];if(!i)return;let r=i.indexOf(n);r!==-1&&delete i[r]}emit(e,...n){let i=this.events[e];!i||i.forEach(r=>setTimeout(r,0,...n))}emitSync(e,...n){let i=this.events[e];!i||i.forEach(r=>r(...n))}};var le=class{constructor(e,n,i){this.events=new j;this.getAnchor=n,this.position=e,this.sections=i;let r=M("div").class("menu"),o=[];i.forEach((m,g)=>{m.forEach(d=>{let y=M("div").class("menu-item").children(M("div").class("menu-item-left").inner(d.name).element,M("div").class("menu-item-right").inner(d.shortcut||"").element).on("click",s=>{let C;try{d.click(s)}catch(_){C=_}if(this.events.emit("click"),C!==void 0)throw C}).element;o.push(y)}),g<i.length-1&&o.push(M("div").class("menu-divider").element)}),this.element=r.children(...o).element}show(e){e.appendChild(this.element);let n=new be(this.element),i=this.element.getBoundingClientRect(),r=this.getAnchor(i,this.position);r.top?n.style("top",this.position.y+"px"):n.style("top",this.position.y-i.height+"px"),r.left?n.style("left",this.position.x+"px"):n.style("left",this.position.x-i.width+"px")}cleanup(){console.log("menu: cleanup",this.element,this.element.parentNode),this.element=this.element.parentNode.removeChild(this.element),this.events=new j}};var Mn=new DOMParser;function Qe(t){return Mn.parseFromString(t,"text/html").body.childNodes[0]}var ft=!1;function ht(){ft=!0,document.body.style.overflow="hidden"}function pt(){ft=!1,document.body.style.overflow="unset"}function ke(t,e,n){return bn[t](e,n)}var bn={kebabMenu:(t,e)=>Qe(`
    <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
      <title>ionicons-v5-f</title>
      <circle cx="256" cy="256" r="32" class="${t}" style="fill:none;stroke-miterlimit:10;stroke-width:32px"/>
      <circle cx="256" cy="416" r="32" class="${t}" style="fill:none;stroke-miterlimit:10;stroke-width:32px"/>
      <circle cx="256" cy="96" r="32" class="${t}" style="fill:none;stroke-miterlimit:10;stroke-width:32px"/>
    </svg>
  `),add:(t,e)=>Qe(`
    <svg viewBox="0 0 512 512" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <path d="M0 0L512 0L512 512L0 512L0 0Z" id="path_1" />
        <clipPath id="mask_1">
          <use xlink:href="#path_1" />
        </clipPath>
      </defs>
      <g id="add-outline-svgrepo-com" transform="translate(16 16)">
        <path d="M0 0L512 0L512 512L0 512L0 0Z" id="Background" fill="none" fill-rule="evenodd" stroke="none" />
        <g clip-path="url(#mask_1)">
          <path d="M1 0L1 288" transform="translate(255 112)" 
            class="${t}" id="Line" fill="none" fill-rule="evenodd" stroke-width="32" stroke-linecap="round" stroke-linejoin="round" />
          <path d="M288 1L0 1" transform="translate(112 255)" 
            class="${t}" id="Line" fill="none" fill-rule="evenodd" stroke-width="32" stroke-linecap="round" stroke-linejoin="round" />
        </g>
      </g>
    </svg>
  `)};var Ce=class{constructor(e){this.menuButtons=[[{name:"hey",click:()=>{this.logging.info("menubar: menu item click")}}]];this.menuReducers=[];this.app=e,this.left=M("div").class("menubar-left").element,this.menuToggle=M("div").class("menubar-menu-toggle").children(M("div").class("menubar-icon").children(ke("kebabMenu","stroke","fill")).element).on("click",()=>{this.menuCurrent?this.hideMenu():this.showMenu()}).element,this.right=M("div").class("menubar-right").children(this.menuToggle).element,this.element=M("div").class("menubar").children(this.left,this.right).element,this.logging=e.modules.logging,this.layout=e.modules.layout,this.layout.mountToMenubar(this.element),document.addEventListener("mousedown",n=>{if(this.logging.info("menubar: menu listener for external mousedown"),!this.menuCurrent)return;document.elementsFromPoint(n.pageX,n.pageY).indexOf(this.menuCurrent.element)===-1&&this.hideMenu()})}showMenu(){this.logging.info("menubar: showMenu"),this.hideMenu();let e=this.menuReducers.map(i=>{let r=i();if(r)return r});if(e.length===0)return;let n=new le({x:this.menuToggle.getBoundingClientRect().right,y:this.element.getBoundingClientRect().bottom},()=>({top:!0,left:!1}),e);this.menuCurrent=n,n.events.on("click",()=>{this.logging.info("menubar: menu event on click"),this.hideMenu()}),n.show(this.app.element)}hideMenu(){this.logging.info("menubar: hideMenu",this.menuCurrent),this.menuCurrent&&(this.menuCurrent.cleanup(),delete this.menuCurrent)}addSectionReducer(e){this.menuReducers.push(e)}setMenubarText(e){this.left.innerText=e}};var ue=class{constructor(e){this.message=e.message,this.container=e.container,this.buttons=e.buttons}prompt(){let e=[];this.buttons.forEach(m=>{let g=M("div").class("modal-button").class(m.kind).inner(m.text).attr("modal-command",m.command).element;e.push(g)});let n=M("div").class("modal-buttons").children(...e).element,i=M("div").class("modal-text").inner(this.message).element,r=M("div").class("modal").children(i,n).element,o=M("div").class("modal-overlay").children(r).element;return ht(),this.container.appendChild(o),new Promise(m=>{let g=new Map;e.forEach(d=>{let y=d.getAttribute("modal-command"),s;s=()=>{for(let[C,_]of g.entries())C.removeEventListener("click",_);o.parentNode.removeChild(o),pt(),m(y)},g.set(d,s),d.addEventListener("click",s)})})}};var xn=/([^\\/]+)[\\/]?$/,En=/(.+)[\\/][^\\/]+[\\/]?$/;function de(t){let e=t.match(xn);return e?e[1]:t}function gt(t){let e=t.match(En);return e?e[1]:t}var Le={noStartPath:t=>`Oops - we couldn't find the path "${t}". Try relaunching the app.`,confirmSaveBeforeClose:()=>"Would you like to save the current document before closing?"};var _t=M("div").inner("...").element,Pe=class{constructor(e){this.events=new j;this.editors=[];this.editorKinds={};this.app=e,this.menubar=e.modules.menubar,this.fs=e.modules.fs,this.system=e.modules.system,this.input=e.modules.input,this.logging=e.modules.logging,this.sidemenu=e.modules.sidemenu,this.filetree=e.modules.filetree,this.confirmCloseModal=new ue({container:this.app.element,message:Le.confirmSaveBeforeClose(),buttons:Sn}),this.element=M("div").class("editor-container").element,e.modules.layout.mountToContents(this.element),this.element.appendChild(_t),this.hookToSidebarMenu(),this.hookToMenubar(),this.hookToInputs(),this.hookToFiletree()}hookToSidebarMenu(){let e=this.sidemenu.createButton("add"),n,i=()=>{n&&(n.cleanup(),n=void 0)},r=()=>{let m=[];for(let g in this.editors){let d=this.editors[g];d.hideFromNewMenu||m.push({name:d.kind,click:()=>{this.newEditor(d.kind),i()}})}return m.length>0&&m},o=()=>{i();let m=e.getBoundingClientRect();n=new le({x:m.right,y:m.top},()=>({top:!1,left:!1}),[r()]),n.show(this.app.element)};e.addEventListener("click",o),document.addEventListener("mousedown",m=>{n&&document.elementsFromPoint(m.pageX,m.pageY).indexOf(n.element)===-1&&i()}),this.sidemenu.addButton(e)}hookToMenubar(){let e=r=>{r?this.menubar.setMenubarText((r.saved?"":"*")+r.name):this.menubar.setMenubarText("")};this.events.on("docSavedChanged",e),this.events.on("docSet",e);let n=this.system.USES_CMD?"Cmd":"Ctrl";this.logging.info("command or ctrl?",n);let i=()=>{let r=[];return r.push({name:"Open",shortcut:n+"+O",click:()=>{this.open()}}),this.currentDocument&&(r.push({name:"Save",shortcut:n+"+S",click:()=>{this.save()}}),r.push({name:"Save As",shortcut:n+"+Shift+S",click:()=>{this.saveAs()}}),r.push({name:"Close",shortcut:n+"+W",click:()=>{this.close()}})),r};this.menubar.addSectionReducer(i)}hookToInputs(){this.input.registerShortcut(["command+o","ctrl+o"],e=>{this.logging.info("editor keys: ctrl o"),e.preventDefault(),this.open()}),this.input.registerShortcut(["command+s","ctrl+s"],e=>{this.logging.info("editor keys: ctrl s"),this.currentDocument&&(e.preventDefault(),this.save())}),this.input.registerShortcut(["command+shift+s","ctrl+shift+s"],e=>{this.logging.info("editor keys: ctrl shift s"),this.currentDocument&&(e.preventDefault(),this.saveAs())}),this.input.registerShortcut(["command+w","ctrl+w"],e=>{this.logging.info("editor keys: ctrl w"),this.currentDocument&&(e.preventDefault(),this.close())})}hookToFiletree(){this.filetree.selectedFile&&this.open(this.filetree.selectedFile).then(()=>{this.logging.info("editors: loaded start file path from filetree",this.filetree.selectedFile)}),this.filetree.events.on("selected",e=>{this.logging.info("editors: load path",e),this.open(e).then(()=>{this.logging.info("editors: loaded path",e)})})}registerEditor(e){if(this.editorKinds[e.kind])throw new Error(`Editor of kind "${e.kind}" already exists!`);this.editorKinds[e.kind]=e,this.editors.push(e)}setCurrentDocument(e){this.currentDocument=e,this.events.emit("docSet",e)}open(e){return w(this,null,function*(){!(yield this.close())||!e&&!(yield this.fs.dialogOpen({directory:!1}))||(yield this.load(e))})}newEditor(e){return w(this,null,function*(){this.logging.info("new editor");let n=this.editorKinds[e];if(!n)throw new Error(`Editor of kind "${e}" does not exist!`);let i=yield this.close();if(this.logging.info("will close?",i),!i)return;this.clear(),this.setCurrentDocument({name:"Untitled",saved:!1});let r=n.provider.createNewEditor();this.currentEditor=r,yield r.startup(this.element,this.makeContext())})}trySaveEditor(){return w(this,null,function*(){try{return yield this.currentEditor.save(this.currentDocument.path),!0}catch(e){return new ue({container:this.element,message:`An error occurred while saving: ${e}`,buttons:[{kind:"emphasis",text:"OK",command:""}]}).prompt(),!1}})}saveAs(){return w(this,null,function*(){if(this.logging.info("save as"),!this.currentEditor||!this.currentDocument)return!0;let e=yield this.fs.dialogSave({});if(this.logging.info("new path",e),!e)return!1;let n=yield this.trySaveEditor();return this.logging.info("save editor success",n),n?(this.setCurrentDocument({path:e,name:de(e),saved:!0}),!0):!1})}save(){return w(this,null,function*(){if(this.logging.info("save"),!this.currentEditor||!this.currentDocument)return!0;if(this.currentDocument.path){if(!(yield this.trySaveEditor()))return!1}else if(!(yield this.saveAs()))return!1;return this.currentDocument.saved=!0,this.events.emit("docSavedChanged",this.currentDocument),!0})}close(){return w(this,null,function*(){if(this.logging.info("close",this.currentDocument,this.currentEditor),!this.currentEditor||!this.currentDocument)return!0;if(this.logging.info("close: has editor and document"),this.currentDocument.path){if(this.currentDocument.saved)return this.logging.info("close: doc has path, is saved"),yield this.cleanup(),!0;switch(this.logging.info("close: doc has path, but not saved"),yield this.confirmCloseModal.prompt()){case"save":return this.logging.info("close modal: save"),(yield this.save())?(yield this.cleanup(),!0):!1;case"cancel":return this.logging.info("close modal: cancel"),!1;case"dontsave":return this.logging.info("close modal: donstave"),yield this.cleanup(),!0}}else return this.logging.info("close: doc has no path"),(yield this.save())?(this.logging.info("close: saved"),yield this.cleanup(),!0):(this.logging.info("close: unsaved"),!1)})}cleanup(){return w(this,null,function*(){this.logging.info("cleanup"),this.currentEditor&&(yield this.currentEditor.cleanup(),delete this.currentEditor),this.clear(),this.element.appendChild(_t),this.currentDocument&&this.setCurrentDocument(void 0)})}clear(){this.element.innerHTML=""}makeContext(){return{updateEdited:()=>{this.currentDocument&&(this.currentDocument.saved=!1,this.events.emit("docSavedChanged",this.currentDocument))},getDocument:()=>this.currentDocument,setDocument:e=>{this.setCurrentDocument(e)}}}load(e){return w(this,null,function*(){yield this.cleanup(),this.clear();let n;for(let i=this.editors.length-1;i>-1;i--){let o=this.editors[i].provider.tryGetEditor(e);if(o){n=o;break}}n&&(this.setCurrentDocument({name:de(e),saved:!0,path:e}),this.currentEditor=n,this.element.innerHTML="",yield n.startup(this.element,this.makeContext()),yield n.load(this.currentDocument.path))})}},Sn=[{kind:"normal",text:"Cancel",command:"cancel"},{kind:"normal",text:"Don't save",command:"dontsave"},{kind:"emphasis",text:"Save",command:"save"}];var Te=class{constructor(e){e&&(this.fs=e)}writeTextFile(e,n){return w(this,null,function*(){if(this.fs)return this.fs.writeTextFile(e,n)})}readTextFile(e){return w(this,null,function*(){return this.fs?this.fs.readTextFile(e):"."})}readDir(e){return w(this,null,function*(){return this.fs?this.fs.readDir(e):{path:"TEMP",children:[]}})}isFile(e){return w(this,null,function*(){return this.fs?this.fs.isFile(e):!1})}isDir(e){return w(this,null,function*(){return this.fs?this.fs.isDir(e):!1})}dialogOpen(e){return w(this,null,function*(){if(this.fs)return this.fs.dialogOpen(e)})}dialogOpenMultiple(e){return w(this,null,function*(){if(this.fs)return this.fs.dialogOpenMultiple(e)})}dialogSave(e){return w(this,null,function*(){if(this.fs)return this.fs.dialogSave(e)})}getConfigDir(){return w(this,null,function*(){return this.fs?this.fs.getConfigDir():"."})}getCurrentDir(){return w(this,null,function*(){return this.fs?this.fs.getCurrentDir():"."})}joinPath(e){return this.fs?this.fs.joinPath(e):e.join("/")}watchInit(e){return w(this,null,function*(){if(this.fs)return this.fs.watchInit(e)})}onWatchEvent(e){if(this.fs)return this.fs.onWatchEvent(e)}};var Fe=class{constructor(e){this.enabled=!0;e.options.isProduction&&(this.enabled=!1,this.info=()=>{})}info(...e){this.enabled&&console.log("[INFO]",...e)}err(...e){console.error("[ERR]",...e)}warn(...e){console.warn("[WARN]",...e)}};var De=class{constructor(e){this.reducers=[];this.app=e;let n=i=>{let r=[];return this.reducers.forEach(o=>{let m=o(i);m&&r.push(m)}),r};this.ctxmenu=new vt(e.element,[e.modules.layout.contents],n)}addSectionReducer(e){this.reducers.push(e)}},vt=class{constructor(e,n,i){this.blacklist=new Set(n);let r=m=>{for(let y of document.elementsFromPoint(m.pageX,m.pageY))if(this.blacklist.has(y)){delete this.activeMenu;return}m.stopPropagation(),m.preventDefault();let g={pageX:m.pageX,pageY:m.pageY,element:document.elementFromPoint(m.pageX,m.pageY)},d=i(g);if(d.length<1){delete this.activeMenu;return}this.activeMenu&&(this.activeMenu.cleanup(),delete this.activeMenu),this.activeMenu=new le({x:m.pageX,y:m.pageY},y=>({top:m.pageY+y.height<innerHeight,left:m.pageX+y.width<innerWidth}),d),this.activeMenu.events.on("click",()=>{this.activeMenu&&(this.activeMenu.cleanup(),delete this.activeMenu)}),this.activeMenu.show(e)},o=m=>{if(console.log("somewhereelse click"),!this.activeMenu)return;document.elementsFromPoint(m.pageX,m.pageY).indexOf(this.activeMenu.element)===-1&&(this.activeMenu.cleanup(),delete this.activeMenu)};document.addEventListener("contextmenu",r),document.addEventListener("mousedown",o),this.cleanup=()=>{document.removeEventListener("contextmenu",r),document.removeEventListener("mousedown",o)}}addBlacklist(e){this.blacklist.add(e)}};var Ie=class{constructor(e){this.system=e,this.USES_CMD=e?e.USES_CMD:!1}};var He=class{constructor(e){this.layout=e.modules.layout,this.element=M("div").class("sidemenu-main").element,this.layout.mountToSidebarMenu(this.element)}createButton(e){return M("div").class("sidemenu-button").children(ke(e,"stroke","fill")).element}addButton(e){this.element.appendChild(e)}};var Ne,b,yt,wn,ge,Mt,bt,kn,Ae={},xt=[],Cn=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function oe(t,e){for(var n in e)t[n]=e[n];return t}function Et(t){var e=t.parentNode;e&&e.removeChild(t)}function x(t,e,n){var i,r,o,m={};for(o in e)o=="key"?i=e[o]:o=="ref"?r=e[o]:m[o]=e[o];if(arguments.length>2&&(m.children=arguments.length>3?Ne.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)m[o]===void 0&&(m[o]=t.defaultProps[o]);return ze(t,m,i,r,null)}function ze(t,e,n,i,r){var o={type:t,props:e,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:r??++yt};return b.vnode!=null&&b.vnode(o),o}function Be(t){return t.children}function Re(t,e){this.props=t,this.context=e}function me(t,e){if(e==null)return t.__?me(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?me(t):null}function St(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return St(t)}}function wt(t){(!t.__d&&(t.__d=!0)&&ge.push(t)&&!Oe.__r++||bt!==b.debounceRendering)&&((bt=b.debounceRendering)||Mt)(Oe)}function Oe(){for(var t;Oe.__r=ge.length;)t=ge.sort(function(e,n){return e.__v.__b-n.__v.__b}),ge=[],t.some(function(e){var n,i,r,o,m,g;e.__d&&(m=(o=(n=e).__v).__e,(g=n.__P)&&(i=[],(r=oe({},o)).__v=o.__v+1,et(g,o,r,n.__n,g.ownerSVGElement!==void 0,o.__h!=null?[m]:null,i,m??me(o),o.__h),Dt(i,o),o.__e!=m&&St(o)))})}function kt(t,e,n,i,r,o,m,g,d,y){var s,C,_,h,E,W,T,A=i&&i.__k||xt,K=A.length;for(n.__k=[],s=0;s<e.length;s++)if((h=n.__k[s]=(h=e[s])==null||typeof h=="boolean"?null:typeof h=="string"||typeof h=="number"||typeof h=="bigint"?ze(null,h,null,null,h):Array.isArray(h)?ze(Be,{children:h},null,null,null):h.__b>0?ze(h.type,h.props,h.key,null,h.__v):h)!=null){if(h.__=n,h.__b=n.__b+1,(_=A[s])===null||_&&h.key==_.key&&h.type===_.type)A[s]=void 0;else for(C=0;C<K;C++){if((_=A[C])&&h.key==_.key&&h.type===_.type){A[C]=void 0;break}_=null}et(t,h,_=_||Ae,r,o,m,g,d,y),E=h.__e,(C=h.ref)&&_.ref!=C&&(T||(T=[]),_.ref&&T.push(_.ref,null,h),T.push(C,h.__c||E,h)),E!=null?(W==null&&(W=E),typeof h.type=="function"&&h.__k!=null&&h.__k===_.__k?h.__d=d=Ct(h,d,t):d=Lt(t,h,_,A,E,d),y||n.type!=="option"?typeof n.type=="function"&&(n.__d=d):t.value=""):d&&_.__e==d&&d.parentNode!=t&&(d=me(_))}for(n.__e=W,s=K;s--;)A[s]!=null&&(typeof n.type=="function"&&A[s].__e!=null&&A[s].__e==n.__d&&(n.__d=me(i,s+1)),Ht(A[s],A[s]));if(T)for(s=0;s<T.length;s++)It(T[s],T[++s],T[++s])}function Ct(t,e,n){var i,r;for(i=0;i<t.__k.length;i++)(r=t.__k[i])&&(r.__=t,e=typeof r.type=="function"?Ct(r,e,n):Lt(n,r,r,t.__k,r.__e,e));return e}function Lt(t,e,n,i,r,o){var m,g,d;if(e.__d!==void 0)m=e.__d,e.__d=void 0;else if(n==null||r!=o||r.parentNode==null){e:if(o==null||o.parentNode!==t)t.appendChild(r),m=null;else{for(g=o,d=0;(g=g.nextSibling)&&d<i.length;d+=2)if(g==r)break e;t.insertBefore(r,o),m=o}}return m!==void 0?m:r.nextSibling}function Ln(t,e,n,i,r){var o;for(o in n)o==="children"||o==="key"||o in e||Ke(t,o,null,n[o],i);for(o in e)r&&typeof e[o]!="function"||o==="children"||o==="key"||o==="value"||o==="checked"||n[o]===e[o]||Ke(t,o,e[o],n[o],i)}function Pt(t,e,n){e[0]==="-"?t.setProperty(e,n):t[e]=n==null?"":typeof n!="number"||Cn.test(e)?n:n+"px"}function Ke(t,e,n,i,r){var o;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof i=="string"&&(t.style.cssText=i=""),i)for(e in i)n&&e in n||Pt(t.style,e,"");if(n)for(e in n)i&&n[e]===i[e]||Pt(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")o=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=n,n?i||t.addEventListener(e,o?Ft:Tt,o):t.removeEventListener(e,o?Ft:Tt,o);else if(e!=="dangerouslySetInnerHTML"){if(r)e=e.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if(e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in t)try{t[e]=n??"";break e}catch(m){}typeof n=="function"||(n!=null&&(n!==!1||e[0]==="a"&&e[1]==="r")?t.setAttribute(e,n):t.removeAttribute(e))}}function Tt(t){this.l[t.type+!1](b.event?b.event(t):t)}function Ft(t){this.l[t.type+!0](b.event?b.event(t):t)}function et(t,e,n,i,r,o,m,g,d){var y,s,C,_,h,E,W,T,A,K,$,B=e.type;if(e.constructor!==void 0)return null;n.__h!=null&&(d=n.__h,g=e.__e=n.__e,e.__h=null,o=[g]),(y=b.__b)&&y(e);try{e:if(typeof B=="function"){if(T=e.props,A=(y=B.contextType)&&i[y.__c],K=y?A?A.props.value:y.__:i,n.__c?W=(s=e.__c=n.__c).__=s.__E:("prototype"in B&&B.prototype.render?e.__c=s=new B(T,K):(e.__c=s=new Re(T,K),s.constructor=B,s.render=Tn),A&&A.sub(s),s.props=T,s.state||(s.state={}),s.context=K,s.__n=i,C=s.__d=!0,s.__h=[]),s.__s==null&&(s.__s=s.state),B.getDerivedStateFromProps!=null&&(s.__s==s.state&&(s.__s=oe({},s.__s)),oe(s.__s,B.getDerivedStateFromProps(T,s.__s))),_=s.props,h=s.state,C)B.getDerivedStateFromProps==null&&s.componentWillMount!=null&&s.componentWillMount(),s.componentDidMount!=null&&s.__h.push(s.componentDidMount);else{if(B.getDerivedStateFromProps==null&&T!==_&&s.componentWillReceiveProps!=null&&s.componentWillReceiveProps(T,K),!s.__e&&s.shouldComponentUpdate!=null&&s.shouldComponentUpdate(T,s.__s,K)===!1||e.__v===n.__v){s.props=T,s.state=s.__s,e.__v!==n.__v&&(s.__d=!1),s.__v=e,e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function(D){D&&(D.__=e)}),s.__h.length&&m.push(s);break e}s.componentWillUpdate!=null&&s.componentWillUpdate(T,s.__s,K),s.componentDidUpdate!=null&&s.__h.push(function(){s.componentDidUpdate(_,h,E)})}s.context=K,s.props=T,s.state=s.__s,(y=b.__r)&&y(e),s.__d=!1,s.__v=e,s.__P=t,y=s.render(s.props,s.state,s.context),s.state=s.__s,s.getChildContext!=null&&(i=oe(oe({},i),s.getChildContext())),C||s.getSnapshotBeforeUpdate==null||(E=s.getSnapshotBeforeUpdate(_,h)),$=y!=null&&y.type===Be&&y.key==null?y.props.children:y,kt(t,Array.isArray($)?$:[$],e,n,i,r,o,m,g,d),s.base=e.__e,e.__h=null,s.__h.length&&m.push(s),W&&(s.__E=s.__=null),s.__e=!1}else o==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=Pn(n.__e,e,n,i,r,o,m,d);(y=b.diffed)&&y(e)}catch(D){e.__v=null,(d||o!=null)&&(e.__e=g,e.__h=!!d,o[o.indexOf(g)]=null),b.__e(D,e,n)}}function Dt(t,e){b.__c&&b.__c(e,t),t.some(function(n){try{t=n.__h,n.__h=[],t.some(function(i){i.call(n)})}catch(i){b.__e(i,n.__v)}})}function Pn(t,e,n,i,r,o,m,g){var d,y,s,C=n.props,_=e.props,h=e.type,E=0;if(h==="svg"&&(r=!0),o!=null){for(;E<o.length;E++)if((d=o[E])&&(d===t||(h?d.localName==h:d.nodeType==3))){t=d,o[E]=null;break}}if(t==null){if(h===null)return document.createTextNode(_);t=r?document.createElementNS("http://www.w3.org/2000/svg",h):document.createElement(h,_.is&&_),o=null,g=!1}if(h===null)C===_||g&&t.data===_||(t.data=_);else{if(o=o&&Ne.call(t.childNodes),y=(C=n.props||Ae).dangerouslySetInnerHTML,s=_.dangerouslySetInnerHTML,!g){if(o!=null)for(C={},E=0;E<t.attributes.length;E++)C[t.attributes[E].name]=t.attributes[E].value;(s||y)&&(s&&(y&&s.__html==y.__html||s.__html===t.innerHTML)||(t.innerHTML=s&&s.__html||""))}if(Ln(t,_,C,r,g),s)e.__k=[];else if(E=e.props.children,kt(t,Array.isArray(E)?E:[E],e,n,i,r&&h!=="foreignObject",o,m,o?o[0]:n.__k&&me(n,0),g),o!=null)for(E=o.length;E--;)o[E]!=null&&Et(o[E]);g||("value"in _&&(E=_.value)!==void 0&&(E!==t.value||h==="progress"&&!E)&&Ke(t,"value",E,C.value,!1),"checked"in _&&(E=_.checked)!==void 0&&E!==t.checked&&Ke(t,"checked",E,C.checked,!1))}return t}function It(t,e,n){try{typeof t=="function"?t(e):t.current=e}catch(i){b.__e(i,n)}}function Ht(t,e,n){var i,r;if(b.unmount&&b.unmount(t),(i=t.ref)&&(i.current&&i.current!==t.__e||It(i,null,e)),(i=t.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(o){b.__e(o,e)}i.base=i.__P=null}if(i=t.__k)for(r=0;r<i.length;r++)i[r]&&Ht(i[r],e,typeof t.type!="function");n||t.__e==null||Et(t.__e),t.__e=t.__d=void 0}function Tn(t,e,n){return this.constructor(t,n)}function Nt(t,e,n){var i,r,o;b.__&&b.__(t,e),r=(i=typeof n=="function")?null:n&&n.__k||e.__k,o=[],et(e,t=(!i&&n||e).__k=x(Be,null,[t]),r||Ae,Ae,e.ownerSVGElement!==void 0,!i&&n?[n]:r?null:e.firstChild?Ne.call(e.childNodes):null,o,!i&&n?n:r?r.__e:e.firstChild,i),Dt(o,t)}Ne=xt.slice,b={__e:function(t,e){for(var n,i,r;e=e.__;)if((n=e.__c)&&!n.__)try{if((i=n.constructor)&&i.getDerivedStateFromError!=null&&(n.setState(i.getDerivedStateFromError(t)),r=n.__d),n.componentDidCatch!=null&&(n.componentDidCatch(t),r=n.__d),r)return n.__E=n}catch(o){t=o}throw t}},yt=0,wn=function(t){return t!=null&&t.constructor===void 0},Re.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=oe({},this.state),typeof t=="function"&&(t=t(oe({},n),this.props)),t&&oe(n,t),t!=null&&this.__v&&(e&&this.__h.push(e),wt(this))},Re.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),wt(this))},Re.prototype.render=Be,ge=[],Mt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Oe.__r=0,kn=0;var tt,ee,At,nt=0,it=[],zt=b.__b,Bt=b.__r,Rt=b.diffed,Ot=b.__c,Kt=b.unmount;function Wt(t,e){b.__h&&b.__h(ee,t,nt||e),nt=0;var n=ee.__H||(ee.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function Ut(t){return nt=1,Fn(Vt,t)}function Fn(t,e,n){var i=Wt(tt++,2);return i.t=t,i.__c||(i.__=[n?n(e):Vt(void 0,e),function(r){var o=i.t(i.__[0],r);i.__[0]!==o&&(i.__=[o,i.__[1]],i.__c.setState({}))}],i.__c=ee),i.__}function ot(t,e){var n=Wt(tt++,7);return In(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function Dn(){it.forEach(function(t){if(t.__P)try{t.__H.__h.forEach(We),t.__H.__h.forEach(st),t.__H.__h=[]}catch(e){t.__H.__h=[],b.__e(e,t.__v)}}),it=[]}b.__b=function(t){ee=null,zt&&zt(t)},b.__r=function(t){Bt&&Bt(t),tt=0;var e=(ee=t.__c).__H;e&&(e.__h.forEach(We),e.__h.forEach(st),e.__h=[])},b.diffed=function(t){Rt&&Rt(t);var e=t.__c;e&&e.__H&&e.__H.__h.length&&(it.push(e)!==1&&At===b.requestAnimationFrame||((At=b.requestAnimationFrame)||function(n){var i,r=function(){clearTimeout(o),$t&&cancelAnimationFrame(i),setTimeout(n)},o=setTimeout(r,100);$t&&(i=requestAnimationFrame(r))})(Dn)),ee=void 0},b.__c=function(t,e){e.some(function(n){try{n.__h.forEach(We),n.__h=n.__h.filter(function(i){return!i.__||st(i)})}catch(i){e.some(function(r){r.__h&&(r.__h=[])}),e=[],b.__e(i,n.__v)}}),Ot&&Ot(t,e)},b.unmount=function(t){Kt&&Kt(t);var e=t.__c;if(e&&e.__H)try{e.__H.__.forEach(We)}catch(n){b.__e(n,e.__v)}};var $t=typeof requestAnimationFrame=="function";function We(t){var e=ee;typeof t.__c=="function"&&t.__c(),ee=e}function st(t){var e=ee;t.__c=t.__(),ee=e}function In(t,e){return!t||t.length!==e.length||e.some(function(n,i){return n!==t[i]})}function Vt(t,e){return typeof e=="function"?e(t):e}function Gt({strokeClass:t}){return x("svg",{viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},x("path",{d:"M416,221.25V416a48,48,0,0,1-48,48H144a48,48,0,0,1-48-48V96a48,48,0,0,1,48-48h98.75a32,32,0,0,1,22.62,9.37L406.63,198.63A32,32,0,0,1,416,221.25Z",className:t,style:"fill:none;stroke-linejoin:round;stroke-width:32px"}),x("path",{d:"M256,56V176a32,32,0,0,0,32,32H408",className:t,style:"fill:none;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"}))}function jt({fillClass:t}){return x("svg",{xmlnsXlink:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",version:"1.1"},x("defs",null,x("path",{d:"M0 0L512 0L512 512L0 512L0 0Z",id:"path_1"}),x("clipPath",{id:"mask_1"},x("use",{xmlnsXlink:"http://www.w3.org/1999/xlink",xlinkHref:"#path_1"}))),x("g",{id:"folder-open-outline-svgrepo-com-Copy"},x("path",{d:"M0 128L0 56C0 40.536 5.46734 27.3367 16.402 16.402C27.3367 5.46734 40.536 -3.8147e-06 56 7.62939e-06L131.89 0C143.195 0.000282288 153.551 3.13628 162.956 9.408L190.795 27.9672C194.827 30.6556 199.265 31.9999 204.11 32L360 32C375.464 32 388.663 37.4674 399.598 48.402C410.533 59.3367 416 72.536 416 88L416 128C416 132.418 414.438 136.189 411.314 139.314C408.19 142.438 404.418 144 400 144C395.582 144 391.81 142.438 388.686 139.314C385.562 136.189 384 132.418 384 128L384 88C384 81.3726 381.657 75.7157 376.971 71.0294C372.284 66.3431 366.627 64 360 64L204.11 64C192.805 63.9997 182.45 60.864 173.045 54.5928L145.204 36.032C141.173 33.3441 136.735 32.0001 131.89 32L56 32C49.3726 32 43.7157 34.3431 39.0294 39.0294C34.3431 43.7157 32 49.3726 32 56L32 128C32 132.418 30.4379 136.189 27.3137 139.314C24.1895 142.438 20.4183 144 16 144C11.5817 144 7.81048 142.438 4.68629 139.314C1.56209 136.189 -3.8147e-06 132.418 0 128L0 128Z",className:t,transform:"translate(48 96)",id:"Vector","fill-rule":"evenodd",stroke:"none"}),x("path",{xmlns:"http://www.w3.org/2000/svg",d:"M32 2.89864e-06Q21.4764 3.04896 13.1421 11.3833Q0 24.5254 0 43.1111L0 241.371C0 253.762 4.3807 264.338 13.1421 273.099C21.9035 281.86 32.4795 286.241 44.87 286.241L371.13 286.241C383.521 286.241 394.096 281.86 402.858 273.099C411.619 264.338 416 253.762 416 241.371L416 43.1111Q416 24.5254 402.858 11.3833C397.302 5.82706 391.016 2.03264 384 4.83332e-06L384 241.371C384 244.925 382.743 247.959 380.23 250.472C377.717 252.985 374.684 254.241 371.13 254.241L44.87 254.241C41.316 254.241 38.2826 252.985 35.7695 250.472C33.2565 247.959 32 244.925 32 241.371L32 2.89864e-06Z",className:t,transform:"translate(48 161.75885)",id:"Vector-Difference","fill-rule":"evenodd",stroke:"none"}),x("path",{d:"M0 0L512 0L512 512L0 512L0 0Z",id:"Background",fill:"none","fill-rule":"evenodd",stroke:"none"})))}function qt({strokeClass:t}){return x("svg",{viewBox:"0 0 544 544",version:"1.1",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/svg"},x("defs",null,x("path",{d:"M0 0L512 0L512 512L0 512L0 0Z",id:"path_1"}),x("clipPath",{id:"mask_1"},x("use",{xlinkHref:"#path_1"}))),x("g",{id:"folder-open-outline-svgrepo-com",transform:"translate(16 16)"},x("path",{d:"M0 0L512 0L512 512L0 512L0 0Z",id:"Background",fill:"none","fill-rule":"evenodd",stroke:"none"}),x("g",{"clip-path":"url(#mask_1)"},x("path",{d:"M0 112L0 40C0 17.9086 17.9086 0 40 0L115.89 0C123.788 0.000198364 131.509 2.33844 138.08 6.72L165.92 25.28C172.491 29.6616 180.212 31.9998 188.11 32L344 32C366.091 32 384 49.9086 384 72L384 112",className:t,transform:"translate(64 80)",id:"Shape",fill:"none","fill-rule":"evenodd","stroke-width":"32","stroke-linecap":"round","stroke-linejoin":"round"}),x("path",{d:"M447.902 34.55L431.682 200C431.682 222.064 413.816 239.961 391.752 240L56.2519 240C34.1878 239.961 16.3218 222.064 16.3219 200L0.101862 34.55C-0.609785 25.648 2.43088 16.8536 8.48899 10.2922C14.5471 3.73085 23.0714 -0.000488281 32.0019 0L416.102 0C425.015 0.027359 433.513 3.77081 439.549 10.3289C445.585 16.8869 448.612 25.6653 447.902 34.55L447.902 34.55Z",className:t,transform:"translate(31.998047 192)",id:"Shape",fill:"none","fill-rule":"evenodd","stroke-width":"32","stroke-linecap":"round","stroke-linejoin":"round"}))))}function Hn(t){let e=ot(()=>de(t.node.path),[t.node.path]),n=()=>t.handleFocus(t.node.path);return x("div",{className:"filetree-item file"+(t.focusedNode===t.node.path?" focused":"")+(t.visible?"":" hidden"),onClick:n},x("div",{className:"filetree-item-icon"},x(Gt,{fillClass:"fill",strokeClass:"stroke"})),e)}function Xt(t){let e=ot(()=>de(t.node.path),[t.node.path]),[n,i]=Ut(t.initExpanded===void 0?!1:t.initExpanded),r=n?()=>i(!1):()=>i(!0);return x("div",{className:"filetree-dir"},x("div",{className:"filetree-item"+(t.visible&&n?"":" hidden"),onClick:r},x("div",{className:"filetree-item-icon"},n?x(qt,{fillClass:"fill",strokeClass:"stroke"}):x(jt,{fillClass:"fill",strokeClass:"stroke"})),e),x("div",{className:"filetree-dir-children"+(t.visible&&n?"":" hidden")},t.node.children.map(o=>o.children?x(Xt,{visible:n,key:o.path,node:o,focusedNode:t.focusedNode,handleFocus:t.handleFocus}):x(Hn,{visible:n,node:o,key:o.path,focusedNode:t.focusedNode,handleFocus:t.handleFocus}))))}function Yt(t){return x("div",{className:"filetree-main"},x(Xt,{visible:!0,key:t.node.path,initExpanded:!0,node:t.node,focusedNode:t.initFocusedNode,handleFocus:t.handleFocus}))}var Ue=class{constructor(e,n){this.events=new j;this.app=e,this.element=M("div").class("filetree-container").element,this.fs=e.modules.fs,this.layout=e.modules.layout,this.ctxmenu=e.modules.ctxmenu,this.logging=e.modules.logging;let i=r=>{};this.ctxmenu.addSectionReducer(i),this.layout.mountToFiletree(this.element),n&&(this.selectedFile=n),this.fs.onWatchEvent(()=>this.refreshTree()),this.refreshTree()}refreshTree(){return w(this,null,function*(){let e=yield this.fs.readDir(this.app.directory);e.children?this.setFileTree(e):this.logging.err("filetree read directory - no children, Dir:",this.app.directory)})}setFileTree(e){this.logging.info("setFileTree",e),this.tree=e,this.updateDisplay()}setSelectedFile(e){this.logging.info("setSelectedFile",e),this.selectedFile=e,this.events.emitSync("selected",e),this.updateDisplay()}updateDisplay(){this.logging.info("filetree updateDisplay",this.tree,this.selectedFile),Nt(x(Yt,{node:this.tree,handleFocus:e=>{this.logging.info("path focused",e),this.setSelectedFile(e)},initFocusedNode:this.selectedFile}),this.element)}};var $e=class{constructor(e){this.SETTINGS_NAME=".mnotesettings";this.settings=this.defaultSettings();this.settingsRules=[Nn];this.events=new j;this.app=e,this.fs=e.modules.fs,this.logging=e.modules.logging}init(){return w(this,null,function*(){this.settingsPath=this.fs.joinPath([yield this.fs.getConfigDir(),this.SETTINGS_NAME]);try{let e=yield this.fs.readTextFile(this.settingsPath),n=JSON.parse(e);if(this.isValidSettings(n))this.settings=n;else throw null}catch(e){yield this.resetSettings()}return this})}persistSettings(){return w(this,null,function*(){this.logging.info("Persist settings to path",this.settingsPath,this.settings),yield this.fs.writeTextFile(this.settingsPath,JSON.stringify(this.settings))})}defaultSettings(){return{}}isValidSettings(e){if(typeof e!="object"||e instanceof Array)return!1;for(let n of this.settingsRules)if(!n(e))return!1;return!0}getKey(e){return this.settings[e]}setKey(e,n){return this.settings[e]=n,this.persistSettings().then(()=>this.events.emit("change",this.settings))}getSettings(){return this.settings}setSettings(e){return this.settings=e,this.persistSettings().then(()=>this.events.emit("change",this.settings))}resetSettings(){return this.settings=this.defaultSettings(),this.persistSettings().then(()=>this.events.emit("change",this.settings))}},Nn=t=>t.theme===void 0||typeof t.theme=="string";var An="#ffffff",zn="#000000",Bn=["#f8f9fa","#f1f3f5","#e9ecef","#dee2e6","#ced4da","#adb5bd","#868e96","#495057","#343a40","#212529"],Rn=["#fff5f5","#ffe3e3","#ffc9c9","#ffa8a8","#ff8787","#ff6b6b","#fa5252","#f03e3e","#e03131","#c92a2a"],On=["#fff0f6","#ffdeeb","#fcc2d7","#faa2c1","#f783ac","#f06595","#e64980","#d6336c","#c2255c","#a61e4d"],Kn=["#f8f0fc","#f3d9fa","#eebefa","#e599f7","#da77f2","#cc5de8","#be4bdb","#ae3ec9","#9c36b5","#862e9c"],Wn=["#f3f0ff","#e5dbff","#d0bfff","#b197fc","#9775fa","#845ef7","#7950f2","#7048e8","#6741d9","#5f3dc4"],Un=["#edf2ff","#dbe4ff","#bac8ff","#91a7ff","#748ffc","#5c7cfa","#4c6ef5","#4263eb","#3b5bdb","#364fc7"],$n=["#e7f5ff","#d0ebff","#a5d8ff","#74c0fc","#4dabf7","#339af0","#228be6","#1c7ed6","#1971c2","#1864ab"],Vn=["#e3fafc","#c5f6fa","#99e9f2","#66d9e8","#3bc9db","#22b8cf","#15aabf","#1098ad","#0c8599","#0b7285"],Gn=["#e6fcf5","#c3fae8","#96f2d7","#63e6be","#38d9a9","#20c997","#12b886","#0ca678","#099268","#087f5b"],jn=["#ebfbee","#d3f9d8","#b2f2bb","#8ce99a","#69db7c","#51cf66","#40c057","#37b24d","#2f9e44","#2b8a3e"],qn=["#f4fce3","#e9fac8","#d8f5a2","#c0eb75","#a9e34b","#94d82d","#82c91e","#74b816","#66a80f","#5c940d"],Xn=["#fff9db","#fff3bf","#ffec99","#ffe066","#ffd43b","#fcc419","#fab005","#f59f00","#f08c00","#e67700"],Yn=["#fff4e6","#ffe8cc","#ffd8a8","#ffc078","#ffa94d","#ff922b","#fd7e14","#f76707","#e8590c","#d9480f"],Zt={white:An,black:zn,gray:Bn,red:Rn,pink:On,grape:Kn,violet:Wn,indigo:Un,blue:$n,cyan:Vn,teal:Gn,green:jn,lime:qn,yellow:Xn,orange:Yn};var z=Zt.gray,Jt={"font-main":"Lato","font-monospace":"Fira Mono","fg-main":z[9],"fg-secondary":z[7],"fg-dim":z[5],"bg-main":"#fff","bg-secondary":z[1],"bg-dim":z[3],shadow:"0px 2px 5px "+z[3],overlay:z[7]+"32","border-main":z[3],"border-dim":z[2],"sidebar-bg-main":z[1],"sidebar-bg-hover":z[3],"sidebar-fg-main":z[9],"sidebar-fg-secondary":z[9],"btn-main-fg":z[9],"btn-main-fg-hover":z[9],"btn-main-bg":z[2],"btn-main-bg-hover":z[3],"btn-emphasis-fg":"#fff","btn-emphasis-fg-hover":"#fff","btn-emphasis-bg":z[6],"btn-emphasis-bg-hover":z[7]},Qt={"font-main":"Lato","font-monospace":"Fira Mono","fg-main":"#B0B6BB","fg-secondary":"#767E85","fg-dim":"#656A70","bg-main":"#2B2D2E","bg-secondary":"#242627","bg-dim":"#5A6164",shadow:"0px 2px 5px #111",overlay:"#11111132","border-main":"#111","border-dim":"#111","sidebar-bg-main":"#242627","sidebar-bg-hover":"#2B2D2E","sidebar-fg-main":"#B0B6BB","sidebar-fg-secondary":"#767E85","btn-main-fg":"#B0B6BB","btn-main-fg-hover":"#B0B6BB","btn-main-bg":"#5A6164","btn-main-bg-hover":"#656A70","btn-emphasis-fg":"#2B2D2E","btn-emphasis-fg-hover":"#2B2D2E","btn-emphasis-bg":"#B0B6BB","btn-emphasis-bg-hover":"#767E85"};function Zn(t,e){document.documentElement.style.setProperty("--mnote-"+t,e)}var Ve=class{constructor(e){this.themes={dark:Qt,light:Jt};this.events=new j;this.app=e,this.settings=e.modules.settings,this.settings.events.on("change",()=>{this.init()}),this.events.on("register",()=>{this.init()})}init(){return w(this,null,function*(){let e=this.settings.getSettings();e.theme?this.rawSetTheme(e.theme):yield this.setTheme("light")})}rawSetTheme(e){let n=this.themes[e];for(let i in n)Zn(i,n[i])}setTheme(e){return w(this,null,function*(){this.hasTheme(e)||(e="light"),yield this.settings.setKey("theme",e),this.rawSetTheme(e)})}registerTheme(e,n){return this.themes[e]=n,this.events.emit("register",e),this}hasTheme(e){return this.themes[e]!==void 0}};var tn=hn(en()),je=class{constructor(e){}registerShortcut(e,n){console.log("input: bind combinations",e),tn.default.bind(e,n)}};var rt=class{constructor(e){this.contents="";this.app=e,this.fs=e.modules.fs,this.textarea=M("textarea").class("plaintext-textarea").class("mousetrap").attr("spellcheck","false").element,this.element=M("div").class("plaintext-editor").children(this.textarea).element}startup(e,n){this.textarea.addEventListener("input",()=>{this.contents=this.textarea.value,n.updateEdited()}),this.container=e,e.appendChild(this.element)}load(e){return w(this,null,function*(){let n=yield this.fs.readTextFile(e);this.textarea.value=n})}cleanup(){this.container.removeChild(this.element)}save(e){return w(this,null,function*(){console.log("plaintext: save file",e,this.contents),yield this.fs.writeTextFile(e,this.contents)})}},nn=class{constructor(e){this.app=e}tryGetEditor(e){return new rt(this.app)}createNewEditor(){return new rt(this.app)}},lt=class{constructor(e){this.app=e}startup(){this.app.modules.editors.registerEditor({kind:"plaintext",provider:new nn(this.app)})}cleanup(){}};var on=class{constructor(e){this.contents="";this.app=e,this.settings=e.modules.settings,this.textarea=M("textarea").class("plaintext-textarea").class("mousetrap").attr("spellcheck","false").element,this.element=M("div").class("plaintext-editor").children(this.textarea).element}startup(e,n){n.setDocument({name:"Settings",path:"donotpromptsaveas",saved:!0}),this.textarea.addEventListener("input",()=>{this.contents=this.textarea.value,n.updateEdited()}),this.container=e,e.appendChild(this.element)}load(e){return w(this,null,function*(){this.textarea.value=JSON.stringify(this.settings.getSettings(),void 0,2)})}cleanup(){this.container.removeChild(this.element)}save(e){return w(this,null,function*(){let n=JSON.parse(this.contents);if(!this.settings.isValidSettings(n))throw new Error("invalid settings");yield this.settings.setSettings(n)})}},sn=class{constructor(e){this.app=e,this.settings=e.modules.settings}tryGetEditor(e){}createNewEditor(){return new on(this.app)}},at=class{constructor(e){this.app=e}startup(){let e=()=>{this.app.modules.editors.newEditor("Settings")};this.app.modules.menubar.addSectionReducer(()=>[{name:"Settings",click:e}]),this.app.modules.editors.registerEditor({kind:"Settings",provider:new sn(this.app),hideFromNewMenu:!0})}cleanup(){}};var qe=class{constructor(e,n){this.modules={};this.options=n;let i=document.querySelector(e);if(!i)throw new Error(`No element with selector "${e}"!`);this.element=M("div").class("mnote").parent(i).element}startup(){return w(this,null,function*(){let e=new Te(this.options.fs),n=new Ie(this.options.system),i=this.options.startPath,r;if(i)if(yield e.isDir(i))this.directory=i;else if(yield e.isFile(i)){r=i;let o=gt(i);this.directory=o}else{this.directory=yield e.getCurrentDir();let o={text:"OK",command:"",kind:"emphasis"};new ue({container:this.element,message:Le.noStartPath(i),buttons:[o]}).prompt()}else this.directory=yield e.getCurrentDir();e.watchInit(this.directory),this.addModule("logging",new Fe(this)).addModule("fs",e).addModule("system",n).addModule("input",new je(this)).addModule("extensions",new we(this)).addModule("settings",yield new $e(this).init()).addModule("layout",new Se(this)).addModule("ctxmenu",new De(this)).addModule("sidemenu",new He(this)).addModule("filetree",new Ue(this,r)).addModule("menubar",new Ce(this)).addModule("editors",new Pe(this)).addModule("themes",yield new Ve(this).init()),this.modules.extensions.add(new lt(this)).add(new at(this))})}addModule(e,n){return this.modules[e]=n,this}};var ct=class{writeTextFile(e,n){return Promise.resolve()}readTextFile(e){return Promise.resolve("lorem ipsum")}readDir(e){let n={path:"dir-a",children:[{path:"file-b"},{path:"file-c"},{path:"dir-d",children:[{path:"file-e"},{path:"file-f"}]}]};return Promise.resolve(n)}isFile(e){return Promise.resolve(!0)}isDir(e){return Promise.resolve(!0)}dialogOpen(e){return Promise.resolve("")}dialogOpenMultiple(e){return Promise.resolve([])}dialogSave(e){return Promise.resolve("")}getConfigDir(){return Promise.resolve("configdir")}getCurrentDir(){return Promise.resolve("currentdir")}joinPath(e){return e.join("/")}watchInit(e){return Promise.resolve()}onWatchEvent(e){}};(()=>w(void 0,null,function*(){yield new qe("#root",{startPath:"startpath",fs:new ct}).startup()}))();})();
//# sourceMappingURL=bundle.js.map
